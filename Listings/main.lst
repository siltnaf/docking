C51 COMPILER V9.54   MAIN                                                                  04/25/2021 05:17:06 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) T
                    -ABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          
   2          /*------------------------------------------------------------------*/
   3          /* --- STC MCU International Limited -------------------------------*/
   4          /* --- STC 1T Series MCU Programme Demo ----------------------------*/
   5          /* --- Fax: 86-755-82944243 ----------------------------------------*/
   6          /* --- Tel: 86-755-82948412 ----------------------------------------*/
   7          /* --- Web: www.STCMCU.com -----------------------------------------*/
   8          /* If you want to use the program or the program referenced in the  */
   9          /* article, please specify in which data and procedures from STC    */
  10          /*------------------------------------------------------------------*/
  11          
  12          /*      ???????????, ?????????, ?????, ?????????.  */
  13          
  14          
  15          /*************  ??????? **************
  16          P1.0 ?ADC??,???????(ASCII),9600,8,N,1.
  17          ??????? MAIN_Fosc ?????????
  18          ******************************************/
  19          
  20          
  21          /*************  ??????  **************/
  22          
  23          #define MAIN_Fosc   22118400L //?????, ??????????????5~35MHZ
  24          
  25          /*************  ??????????? **************/
  26          #include  "reg51.H"
  27          #define uchar unsigned char
  28          #define uint  unsigned int
  29          /******************************************/
  30          
  31          sfr P1ASF     = 0x9D; //12C5204AD/S2??????(AD?LVD)??
  32          sfr ADC_CONTR = 0xBC; //?AD??
  33          sfr ADC_RES   = 0xBD; //?AD??
  34          sfr ADC_RESL  = 0xBE; //?AD??
  35          
  36          //                7       6      5       4         3      2    1    0   Reset Value
  37          //sfr ADC_CONTR = 0xBC;   ADC_POWER SPEED1 SPEED0 ADC_FLAG ADC_START CHS2 CHS1 CHS0 0000,0000 //AD ??????? 
  38          #define ADC_OFF() ADC_CONTR = 0
  39          #define ADC_ON    (1 << 7)
  40          #define ADC_90T   (3 << 5)
  41          #define ADC_180T  (2 << 5)
  42          #define ADC_360T  (1 << 5)
  43          #define ADC_540T  0
  44          #define ADC_FLAG  (1 << 4)  //???0
  45          #define ADC_START (1 << 3)  //???0
  46          #define ADC_CH0   0
  47          #define ADC_CH1   1
  48          #define ADC_CH2   2
  49          #define ADC_CH3   3
  50          #define ADC_CH4   4
  51          #define ADC_CH5   5
  52          #define ADC_CH6   6
  53          #define ADC_CH7   7
  54          
C51 COMPILER V9.54   MAIN                                                                  04/25/2021 05:17:06 PAGE 2   

  55          
  56          /************* ?????? **************/
  57          sbit  P_TXD1 = P3^1;
  58          
  59          
  60          /************* ?????? **************/
  61          void  Tx1Send(uchar dat);
  62          void  PrintString(unsigned char code *puts);
  63          void    delay_ms(unsigned char ms);
  64          uchar GetAdc8(uchar channel); //channel = 0~7
  65          
  66          
  67          void TX_ADC(uchar chn, uchar adc)
  68          {
  69   1        Tx1Send('A');
  70   1        Tx1Send('D');
  71   1        Tx1Send(chn+'0');
  72   1        Tx1Send('=');
  73   1        Tx1Send(adc / 100 + '0');
  74   1        Tx1Send(adc % 100 / 10 + '0');
  75   1        Tx1Send(adc % 10 + '0');
  76   1        Tx1Send(0x0d);
  77   1        Tx1Send(0x0a);
  78   1      }
  79          
  80          /********************* ??? *************************/
  81          void main(void)
  82          {
  83   1        uint  j;
  84   1      
  85   1        PrintString("****** STC12C5204AD??ADC?? 2011-02-27 ******\r\n");  //?????????????
  86   1      
  87   1        P1ASF = 1 << ADC_CH0;     //12C5204AD??????(AD)??
  88   1        ADC_CONTR = ADC_360T | ADC_ON;
  89   1      
  90   1        while(1)
  91   1        {
  92   2          delay_ms(250);    //1???1?
  93   2          delay_ms(250);
  94   2          delay_ms(250);
  95   2          delay_ms(250);
  96   2          
  97   2          GetAdc8(0);     // P1.0 ADC, ??
  98   2          j = GetAdc8(0);   // P1.0 ADC
  99   2          TX_ADC(0,j);
 100   2      
 101   2          Tx1Send(0x0d);
 102   2          Tx1Send(0x0a);
 103   2        }
 104   1      }
 105          
 106          /********************* ???ADC?? *******************/
 107          uchar GetAdc8(uchar channel)  //channel = 0~7
 108          {
 109   1        uchar i;
 110   1      
 111   1        ADC_RES = 0;
 112   1      
 113   1        ADC_CONTR = (ADC_CONTR & 0xe0) | ADC_START | channel; 
 114   1      
 115   1        for(i=0; i<250; i++)    //13T/loop, 40*13=520T=23.5us @ 22.1184M
 116   1        {
C51 COMPILER V9.54   MAIN                                                                  04/25/2021 05:17:06 PAGE 3   

 117   2          if(ADC_CONTR & ADC_FLAG)
 118   2          {
 119   3            ADC_CONTR &= ~ADC_FLAG;
 120   3            return  ADC_RES;
 121   3          }
 122   2        }while(--i);
 123   1        return  0;  //??
 124   1      }
 125          
 126          //========================================================================
 127          // ??: void  delay_ms(unsigned char ms)
 128          // ??: ?????
 129          // ??: ms,????ms?.
 130          // ??: none.
 131          // ??: VER1.0
 132          // ??: 2010-12-15
 133          // ??: 
 134          //========================================================================
 135          void  delay_ms(unsigned char ms)
 136          {
 137   1           unsigned int i;
 138   1         do{
 139   2              i = MAIN_Fosc / 14000;
 140   2            while(--i)  ;   //14T per loop
 141   2           }while(--ms);
 142   1      }
 143          
 144          
 145          /********************** ????????************************/
 146          
 147          void  BitTime(void) //?????
 148          {
 149   1        uint i;
 150   1        i = ((MAIN_Fosc / 100) * 104) / 140000L - 1;    //???????????
 151   1        while(--i);
 152   1      }
 153          
 154          //??????
 155          void  Tx1Send(uchar dat)    //9600,N,8,1    ??????
 156          {
 157   1        uchar i;
 158   1        EA = 0;
 159   1        P_TXD1 = 0;
 160   1        BitTime();
 161   1        for(i=0; i<8; i++)
 162   1        {
 163   2          if(dat & 1)   P_TXD1 = 1;
 164   2          else      P_TXD1 = 0;
 165   2          dat >>= 1;
 166   2          BitTime();
 167   2        }
 168   1        P_TXD1 = 1;
 169   1        EA = 1;
 170   1        BitTime();
 171   1        BitTime();
 172   1      }
 173          
 174          void PrintString(unsigned char code *puts)    //???????
 175          {
 176   1          for (; *puts != 0;  puts++)  Tx1Send(*puts);  //?????0??
 177   1      }

C51 COMPILER V9.54   MAIN                                                                  04/25/2021 05:17:06 PAGE 4   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    266    ----
   CONSTANT SIZE    =     47    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       4
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
